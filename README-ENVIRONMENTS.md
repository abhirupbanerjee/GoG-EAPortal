# Multi-Environment Deployment Guide

## Overview
This project supports three environments managed through a single `DEPLOYMENT_ENV` variable:
- **dev** → `*.abhirup.app`
- **pre-prod** → `*.xyz`
- **prod** → `*.gea.gov.gd`

## Quick Start

### 1. Choose Your Environment
```bash
# Development
cp .env.dev .env

# Pre-Production
cp .env.pre-prod .env

# Production
cp .env.prod .env
```

### 2. Deploy
```bash
./scripts/deploy.sh
```

## Environment Switching

### Switch to Development
```bash
./scripts/set-environment.sh dev
```

### Switch to Pre-Production
```bash
./scripts/set-environment.sh pre-prod
```

### Switch to Production
```bash
./scripts/set-environment.sh prod
```

## DNS Configuration

### Development (abhirup.app)
Create A records pointing to your server IP:
- gea.abhirup.app
- api.gea.abhirup.app
- cms.gea.abhirup.app
- minio.gea.abhirup.app
- minio-console.gea.abhirup.app
- db.gea.abhirup.app
- search.gea.abhirup.app
- traefik.gea.abhirup.app

### Pre-Production (xyz)
Create A records pointing to your server IP:
- gea.xyz
- api.gea.xyz
- cms.gea.xyz
- minio.gea.xyz
- minio-console.gea.xyz
- db.gea.xyz
- search.gea.xyz
- traefik.gea.xyz

### Production (gea.gov.gd)
Create A records pointing to your server IP:
- gea.gov.gd
- api.gea.gov.gd
- cms.gea.gov.gd
- minio.gea.gov.gd
- minio-console.gea.gov.gd
- db.gea.gov.gd
- search.gea.gov.gd
- traefik.gea.gov.gd

## Service Access

After deployment, access services at:
- **Frontend**: https://{FRONTEND_DOMAIN}
- **API**: https://{API_DOMAIN}
- **CMS**: https://{CMS_DOMAIN}
- **MinIO**: https://{MINIO_DOMAIN}
- **MinIO Console**: https://{MINIO_CONSOLE_DOMAIN}
- **Database Admin**: https://{DB_DOMAIN}
- **Search Engine**: https://{SEARCH_DOMAIN}
- **Traefik Dashboard**: https://{TRAEFIK_DOMAIN}

## SSL Certificates
SSL certificates are automatically generated by Traefik using Let's Encrypt.
No manual certificate management required.

## Troubleshooting

### Check Service Status
```bash
docker-compose ps
```

### View Logs
```bash
# All services
docker-compose logs -f

# Specific service
docker-compose logs -f traefik
docker-compose logs -f frontend
```

### Validate Configuration
```bash
./scripts/validate-env.sh
```

### Restart Services
```bash
docker-compose restart
```

## Security Notes
- Never commit `.env` file to git
- Rotate passwords regularly
- Use strong passwords for production
- Enable Traefik dashboard authentication
- Restrict access to sensitive endpoints